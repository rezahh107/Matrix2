# راهنمای کاربری سامانه تخصیص دانشجو-منتور

## درباره این راهنما
این راهنما برای کاربرانی نوشته شده که می‌خواهند برنامه تخصیص دانشجو-منتور را روی کامپیوتر ویندوزی خود اجرا کنند. **نیازی به دانش برنامه‌نویسی ندارید** - فقط مراحل را گام به گام دنبال کنید.

**سیستم مورد نیاز:**
- ویندوز 10 یا 11
- حداقل 4 گیگابایت رم
- حداقل 1 گیگابایت فضای خالی هارد

---

## مرحله 1: نصب Python

### چرا Python نیاز است؟
این برنامه با زبان Python نوشته شده و برای اجرای آن باید Python روی کامپیوتر شما نصب باشد.

### مراحل نصب:

1. **دانلود Python:**
   - به آدرس [https://www.python.org/downloads](https://www.python.org/downloads) بروید
   - روی دکمه زرد "Download Python" کلیک کنید
   - فایل نصبی (مثلاً `python-3.11.x.exe`) دانلود می‌شود

2. **نصب Python:**
   - فایل دانلود شده را اجرا کنید
   - ⚠️ **مهم:** قبل از کلیک روی "Install Now"، حتماً گزینه **"Add python.exe to PATH"** را در پایین پنجره تیک بزنید
   - روی "Install Now" کلیک کنید و منتظر بمانید تا نصب تکمیل شود
   - در پایان روی "Close" کلیک کنید

3. **بررسی نصب:**
   - کلیدهای `Windows + R` را با هم فشار دهید
   - کلمه `cmd` را تایپ کنید و Enter بزنید (یک پنجره مشکی باز می‌شود)
   - دستور زیر را تایپ و Enter بزنید:
     ```
     python --version
     ```
   - باید شماره نسخه Python (مثلاً `Python 3.11.5`) نمایش داده شود
   - اگر خطا دریافت کردید، کامپیوتر را Restart کنید و دوباره امتحان کنید

---

## مرحله 2: دانلود و آماده‌سازی برنامه

### دانلود فایل‌های برنامه:

1. فایل فشرده (ZIP) برنامه را از منبع معتبر (ایمیل سازمانی یا سرور داخلی) دریافت کنید

2. **استخراج فایل‌ها:**
   - روی فایل ZIP راست‌کلیک کنید
   - گزینه "Extract All..." را انتخاب کنید
   - مسیر `C:\MatrixApp` را وارد کنید (یا هر مسیری بدون فاصله و حروف فارسی)
   - روی "Extract" کلیک کنید

3. **بررسی محتویات:**
   - پوشه `C:\MatrixApp` را باز کنید
   - باید فایل‌ها و پوشه‌هایی مانند این‌ها را ببینید:
     - پوشه `app`
     - پوشه `config`
     - فایل `requirements.txt`
     - فایل `README.md`

---

## مرحله 3: نصب برنامه

### باز کردن PowerShell در پوشه برنامه:

1. پوشه `C:\MatrixApp` را در File Explorer باز کنید

2. **باز کردن PowerShell:**
   - در نوار آدرس بالای پنجره (جایی که آدرس پوشه نوشته شده)، یک بار کلیک کنید
   - کلمه `powershell` را تایپ کنید
   - Enter بزنید
   - یک پنجره آبی (PowerShell) باز می‌شود

### نصب برنامه:

در پنجره PowerShell، دستورات زیر را **به ترتیب** تایپ کنید و بعد از هر دستور Enter بزنید:

1. **ساخت محیط مجازی:**
   ```powershell
   python -m venv .venv
   ```
   - منتظر بمانید تا پوشه `.venv` ساخته شود (حدود 30 ثانیه)

2. **فعال‌سازی محیط مجازی:**
   ```powershell
   .\.venv\Scripts\Activate.ps1
   ```
   - اگر خطای "running scripts is disabled" دریافت کردید:
     - این دستور را اجرا کنید:
       ```powershell
       Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
       ```
     - وقتی سوال پرسید، حرف `Y` را تایپ و Enter بزنید
     - دوباره دستور فعال‌سازی را اجرا کنید

   - بعد از فعال‌سازی، در ابتدای خط باید `(.venv)` نمایش داده شود

3. **به‌روزرسانی pip:**
   ```powershell
   python -m pip install --upgrade pip
   ```

4. **نصب کتابخانه‌های مورد نیاز:**
   ```powershell
   pip install -r requirements.txt
   ```
   - این مرحله ممکن است 2-5 دقیقه طول بکشد
   - منتظر بمانید تا پیغام "Successfully installed..." نمایش داده شود

---

## مرحله 4: آماده‌سازی فایل‌های ورودی

قبل از اجرای برنامه، باید فایل‌های Excel ورودی را آماده کنید:

### فایل‌های مورد نیاز:

1. **فایل Inspactor** - اطلاعات منتورها
2. **فایل Schools** - اطلاعات مدارس
3. **فایل Crosswalk** - جدول تبدیل پایه تحصیلی

### نکات مهم:

- ✅ فایل‌ها باید فرمت `.xlsx` (Excel) باشند
- ✅ نام ستون‌ها دقیقاً باید مطابق الگوی سازمانی باشند
- ✅ فایل Crosswalk باید شیتی با نام **"پایه تحصیلی (گروه آزمایشی)"** داشته باشد
- ✅ مسیر فایل‌ها را یادداشت کنید (مثلاً `C:\Users\YourName\Desktop\data\Inspactor.xlsx`)

### مسیر پیشنهادی:
فایل‌های ورودی را در یک پوشه مشخص (مثلاً `C:\MatrixApp\data`) قرار دهید تا دسترسی راحت‌تر باشد.

---

## مرحله 5: اجرای برنامه

### راه‌اندازی رابط گرافیکی:

1. اگر پنجره PowerShell را بسته‌اید، دوباره آن را باز کنید (مطابق **مرحله 3**)

2. محیط مجازی را فعال کنید:
   ```powershell
   .\.venv\Scripts\Activate.ps1
   ```
   - باید `(.venv)` در ابتدای خط ظاهر شود

3. **اجرای برنامه:**
   ```powershell
   python -m app.main
   ```

4. یک پنجره گرافیکی با عنوان "سامانه تخصیص دانشجو-منتور" باز می‌شود

### استفاده از رابط کاربری:

پنجره برنامه شامل این بخش‌ها است:

1. **نوار وضعیت:** نمایش وضعیت فعلی برنامه (مثلاً "آماده")
2. **نوار پیشرفت:** نمایش درصد پیشرفت کار در حال اجرا
3. **پنجره گزارش:** نمایش جزئیات و پیام‌های سیستم
4. **دکمه "اجرای تست":** برای آزمایش عملکرد برنامه

### اجرای تست اولیه:

قبل از کار واقعی، حتماً یک تست انجام دهید:

1. روی دکمه **"اجرای تست"** کلیک کنید
2. نوار پیشرفت باید از 0% تا 100% پیش برود
3. در پنجره گزارش باید پیام‌های مختلف نمایش داده شوند
4. اگر همه چیز درست کار کرد، برنامه آماده استفاده واقعی است

---

## مرحله 6: ساخت ماتریس احراز صلاحیت

### از طریق خط فرمان (روش پیشنهادی):

1. در پنجره PowerShell (با محیط مجازی فعال)، دستور زیر را **در یک خط** تایپ کنید:

```powershell
python -m app.infra.cli build-matrix --inspactor "C:\path\to\Inspactor.xlsx" --schools "C:\path\to\Schools.xlsx" --crosswalk "C:\path\to\Crosswalk.xlsx" --output "C:\output\matrix.xlsx"
```

**⚠️ نکته مهم:** مسیرها را با مسیر واقعی فایل‌های خودتان جایگزین کنید

2. Enter بزنید و منتظر بمانید (ممکن است 1-5 دقیقه طول بکشد)

3. بعد از اتمام، فایل خروجی در مسیر مشخص شده ذخیره می‌شود

### محتویات فایل خروجی:

فایل Excel خروجی شامل این شیت‌ها است:
- **matrix:** ماتریس اصلی احراز صلاحیت
- **validation:** گزارش اعتبارسنجی داده‌ها
- **removed:** رکوردهای حذف شده و دلیل حذف
- سایر شیت‌های کمکی و گزارش‌ها

---

## مرحله 7: تخصیص دانش‌آموزان به منتورها

### اجرای فرآیند تخصیص:

1. در پنجره PowerShell، دستور زیر را اجرا کنید:

```powershell
python -m app.infra.cli allocate --students "C:\path\to\students.xlsx" --pool "C:\path\to\mentor_pool.xlsx" --output "C:\output\allocations.xlsx"
```

2. مسیرها را با فایل‌های واقعی جایگزین کنید

3. منتظر بمانید تا فرآیند تخصیص تکمیل شود

### محتویات فایل تخصیص:

- **allocations:** لیست تخصیص‌های انجام شده
- **updated_pool:** وضعیت به‌روز منتورها
- **logs:** گزارش کامل عملیات
- **trace:** جزئیات تصمیم‌گیری (برای بررسی دقیق)

---

## رفع مشکلات رایج

### مشکل 1: پیام "Python is not recognized"
**راه حل:**
- Python را مجدداً نصب کنید و حتماً گزینه "Add to PATH" را تیک بزنید
- کامپیوتر را Restart کنید

### مشکل 2: خطا در فعال‌سازی محیط مجازی
**راه حل:**
- دستور زیر را اجرا کنید:
  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
  ```
- سپس `Y` را تایپ و Enter بزنید

### مشکل 3: "ModuleNotFoundError: PySide6"
**راه حل:**
- محیط مجازی را فعال کنید
- دستور نصب کتابخانه‌ها را دوباره اجرا کنید:
  ```powershell
  pip install -r requirements.txt
  ```

### مشکل 4: خطای خواندن فایل Excel
**راه حل:**
- مطمئن شوید فایل‌ها بسته هستند (در Excel با
