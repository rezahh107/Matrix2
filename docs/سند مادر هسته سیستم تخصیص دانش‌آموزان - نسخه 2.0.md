# سند مادر هسته سیستم تخصیص دانش‌آموزان — نسخه 2.0

## پوشش ماتریس (matrix.coverage)
- کلیدهای پیوست برای سنجش پوشش دقیقاً شش‌گانهٔ Policy هستند: «کدرشته»، «جنسیت»، «دانش آموز فارغ»، «مرکز گلستان صدرا»، «مالی حکمت بنیاد»، «کد مدرسه».
- مخرج پوشش از گروه‌های منتور ساخته می‌شود که پس از فیلتر alias/capacity قابل تولید سطر هستند. حالت مخرج از `matrix.coverage.denominator_mode` در policy.json کنترل می‌شود:
  - `mentors`: فقط گروه‌های قابل‌تولید از منتورها.
  - `mentors_students_intersection`: اشتراک گروه‌های قابل‌تولید با گروه‌های دانش‌آموز.
  - `mentors_students_union`: اجتماع دو فضا.
- پارامتر `matrix.coverage.include_blocked_candidates_in_denominator` مشخص می‌کند گروه‌های مسدود (فاقد alias/ظرفیت) فقط گزارش شوند یا در مخرج بیایند.
- شمارندهٔ `invalid_group_token_count` صرفاً توکن‌های نامعتبر (گروه‌های مفقود/نامچسبیده) را ثبت می‌کند و در مخرج پوشش وارد نمی‌شود.
- `unseen_group_count` اکنون فقط گروه‌های «viable» بدون سطر ماتریس را شامل می‌شود تا نسبت پوشش متکی بر گروه‌های قابل تحقق باقی بماند.
- فیلدهای validation/meta (coverage_ratio، unseen_group_count، invalid_group_token_count، coverage_denominator_groups، unmatched_school_count) مستقیم از CoverageMetrics پر می‌شوند و در هیچ مرحله‌ای دوباره محاسبه نمی‌شوند.
- فرمول پوشش: `coverage_ratio = covered_groups / total_groups` که در آن `total_groups` صرفاً گروه‌های in_coverage_denominator (پیش‌فرض mentor-only) است؛ `invalid_group_token_count` و `unmatched_school_count` فقط برای دیباگ گزارش می‌شوند و مخرج را تغییر نمی‌دهند.
